# Умный склад - Frontend

Веб-приложение для мониторинга складских операций с использованием автономных роботов и искусственного интеллекта для прогнозирования остатков продукции.

## Технологический стек

- **React 18** - UI библиотека
- **TypeScript** - Типизация
- **Vite** - Сборщик и dev-сервер
- **Redux Toolkit** - Управление состоянием
- **Material-UI (MUI)** - UI компоненты
- **React Router** - Маршрутизация
- **Socket.IO Client** - WebSocket соединение
- **Recharts** - Графики и диаграммы
- **React Dropzone** - Загрузка файлов
- **date-fns** - Работа с датами
- **Axios** - HTTP клиент

## Структура проекта

```
frontend/
├── src/
│   ├── components/          # Переиспользуемые компоненты
│   │   ├── Header.tsx
│   │   ├── WSIndicator.tsx
│   │   ├── WarehouseMap.tsx
│   │   ├── RealTimeStats.tsx
│   │   ├── RecentScansTable.tsx
│   │   ├── AIPredictions.tsx
│   │   ├── HistoryFilters.tsx
│   │   └── CSVUploadModal.tsx
│   ├── pages/               # Страницы приложения
│   │   ├── LoginPage.tsx
│   │   ├── DashboardPage.tsx
│   │   └── HistoryPage.tsx
│   ├── store/               # Redux store
│   │   ├── index.ts
│   │   ├── hooks.ts
│   │   └── slices/
│   │       ├── authSlice.ts
│   │       ├── dashboardSlice.ts
│   │       └── historySlice.ts
│   ├── services/            # API сервисы
│   │   ├── api.ts
│   │   └── websocket.ts
│   ├── types/               # TypeScript типы
│   │   └── index.ts
│   ├── App.tsx              # Главный компонент
│   ├── main.tsx             # Точка входа
│   └── index.css            # Глобальные стили
├── index.html
├── package.json
├── tsconfig.json
├── vite.config.ts
└── README.md
```

## Функциональность

### 1. Страница авторизации (`/login`)
- Форма входа с валидацией email и пароля
- JWT аутентификация
- Чекбокс "Запомнить меня"
- Восстановление пароля
- Автоматический редирект на dashboard после входа

### 2. Страница мониторинга (`/dashboard`)
**Блок 1: Карта склада**
- Интерактивная SVG карта с зонами A-E
- Отображение позиций роботов в реальном времени
- Цветовая индикация статуса роботов (активен/низкий заряд/офлайн)
- Zoom и панорамирование карты
- Tooltip с информацией о роботе при наведении

**Блок 2: Статистика в реальном времени**
- Активные роботы (количество/всего)
- Проверено товаров сегодня
- Критические остатки
- Средний заряд батарей
- Автообновление каждые 5 секунд

**Блок 3: Таблица последних сканирований**
- 20 последних сканирований
- Информация: время, робот, зона, товар, количество, статус
- Цветовые badge для статусов
- Автоскролл новых записей
- Кнопка паузы автообновления
- Анимация новых записей

**Блок 4: Предиктивная аналитика ИИ**
- Прогноз на 7 дней
- 5 товаров с критическим прогнозом
- Текущий остаток
- Прогнозируемая дата исчерпания
- Рекомендуемое количество для заказа
- Индикатор достоверности прогноза
- Кнопка обновления прогноза

**WebSocket индикатор**
- Зеленый - соединение активно
- Красный - соединение потеряно
- Пульсирующая анимация

### 3. Страница исторических данных (`/history`)
**Панель фильтров**
- Date picker для выбора периода (От/До)
- Быстрые фильтры: Сегодня, Вчера, Неделя, Месяц
- Фильтр по зонам склада (A-E)
- Фильтр по статусам (OK, Низкий остаток, Критично)
- Поиск по артикулу или названию товара
- Кнопки "Применить" и "Сбросить"

**Сводная статистика**
- Всего проверок за период
- Уникальных товаров
- Выявлено расхождений
- Среднее время инвентаризации зоны

**Таблица данных**
- Колонки: Дата/время, ID робота, Зона, Артикул, Название, Количество, Статус
- Сортировка по всем колонкам
- Пагинация (20/50/100 записей на страницу)
- Server-side пагинация
- Выбор записей через checkbox
- Выделенные строки для выбранных записей

**Экспорт данных**
- Экспорт в Excel (.xlsx)
- Экспорт в PDF (.pdf)
- Экспорт только выбранных записей

**Загрузка CSV**
- Drag & Drop интерфейс
- Предпросмотр первых 5 строк
- Валидация формата
- Прогресс-бар загрузки
- Отчет о результатах (успешно/ошибки)

## Установка и запуск

### Требования
- Node.js >= 18.0.0
- npm >= 9.0.0

### Установка зависимостей
```bash
cd frontend
npm install
```

### Настройка окружения
Создайте файл `.env` на основе `.env.example`:
```bash
cp .env.example .env
```

Настройте переменные окружения:
```env
VITE_API_URL=http://localhost:3000/api
VITE_WS_URL=ws://localhost:3000
```

### Запуск development сервера
```bash
npm run dev
```
Приложение будет доступно по адресу: http://localhost:3001

### Сборка для production
```bash
npm run build
```
Собранные файлы будут в папке `dist/`

### Предпросмотр production сборки
```bash
npm run preview
```

## API Endpoints

### Аутентификация
- `POST /api/auth/login` - Вход в систему
- `POST /api/auth/logout` - Выход из системы

### Dashboard
- `GET /api/dashboard/current` - Текущее состояние склада
- `POST /api/ai/predict` - Получить прогнозы ИИ

### История
- `GET /api/inventory/history` - История инвентаризации
- `POST /api/inventory/import` - Загрузка CSV
- `GET /api/export/excel` - Экспорт в Excel
- `GET /api/export/pdf` - Экспорт в PDF

### WebSocket
- `/api/ws/dashboard` - WebSocket соединение
- События: `robot_update`, `new_scan`, `inventory_alert`

## Форматы данных

### CSV файл для импорта
```csv
product_id;product_name;quantity;zone;date;row;shelf
TEL-4567;Роутер RT-AC68U;45;A;2024-03-15;12;3
TEL-8901;Модем DSL-2640U;12;B;2024-03-15;5;2
```

### Требования к CSV:
- Разделитель: `;` (точка с запятой)
- Кодировка: UTF-8
- Обязательные колонки: `product_id`, `product_name`, `quantity`, `zone`, `date`, `row`, `shelf`

## Роли пользователей

- **operator** - Оператор склада (чтение, загрузка CSV)
- **admin** - Администратор (полный доступ)
- **viewer** - Наблюдатель (только чтение)

## Особенности реализации

### Оптимизация производительности
- Мемоизация компонентов с React.memo
- Lazy loading для тяжелых компонентов
- Виртуализация больших списков (через DataGrid)
- Дебаунс для поисковых запросов
- Server-side пагинация

### Обработка ошибок
- Перехват ошибок через axios interceptors
- Автоматический logout при 401 ошибке
- Отображение понятных сообщений об ошибках
- Fallback UI для критических ошибок

### Безопасность
- JWT токены хранятся в localStorage
- Автоматическое добавление токена к запросам
- Protected routes через React Router
- Валидация данных на клиенте

### Responsive дизайн
- Адаптивная сетка через MUI Grid
- Breakpoints для разных экранов
- Мобильная версия для всех страниц

## Тестирование

```bash
# Запуск тестов
npm run test

# Запуск линтера
npm run lint
```

## Развертывание

### Docker
```bash
# Сборка образа
docker build -t smart-warehouse-frontend .

# Запуск контейнера
docker run -p 80:80 smart-warehouse-frontend
```

### Nginx конфигурация
```nginx
server {
    listen 80;
    server_name localhost;
    root /usr/share/nginx/html;
    index index.html;

    location / {
        try_files $uri $uri/ /index.html;
    }

    location /api {
        proxy_pass http://backend:3000;
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection 'upgrade';
        proxy_set_header Host $host;
        proxy_cache_bypass $http_upgrade;
    }
}
```

## Troubleshooting

### WebSocket не подключается
- Проверьте правильность `VITE_WS_URL` в `.env`
- Убедитесь, что backend запущен и слушает WebSocket соединения
- Проверьте CORS настройки на backend

### Ошибки при сборке
```bash
# Очистка кеша и переустановка зависимостей
rm -rf node_modules package-lock.json
npm install
```

### Проблемы с типами TypeScript
```bash
# Проверка типов
npx tsc --noEmit
```

## Лицензия

Проект разработан для Ростелеком.

## Поддержка

Для вопросов и предложений создавайте Issue в репозитории проекта.
